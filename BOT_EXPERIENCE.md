# Roblox Match Bot — пользовательский опыт и UI

## Назначение и ценность
- Телеграм-бот помогает игрокам Roblox находить напарников для конкретных режимов, учитывать возраст и язык, быстро выходить на личный чат и удобно вести переписку без обмена контактами.
- Формирует безопасное пространство: регистрация с проверкой ника, гибкие фильтры поиска, блокировки и жалобы прямо из интерфейса.
- Поддерживает реэнгейджмент: напоминает вернуться, если пользователь давно не заходил, и аккуратно восстанавливает состояние поиска или чата.

## Роли
- Обычный пользователь: регистрируется, настраивает профиль, ищет напарников, листает каталоги, переписывается, блокирует и жалуется.
- Администратор/суб-администратор: следит за метриками, управляет пользователями и банами, просматривает чаты/истории, настраивает список игр и отправляет широкие уведомления.

## Основные сценарии
1) Первое касание (`/start`):
   - Бот приветствует, спрашивает ник Roblox, возраст, язык интерфейса/поиска и до пяти режимов (есть подсказки популярных режимов по языку).
   - Дополнительно просит короткое описание и аватар. Все шаги подтверждаются inline-кнопками; ввод сопровождается подсказками с допустимыми значениями.
   - После регистрации выводится приветственное меню с короткими маршрутами: `/browse`, `/search`, `/chat`, `/profile`, `/help`.
2) Быстрая навигация:
   - Команды функционируют как «экраны» в чате. Основные действия повторяются на inline-кнопках (например, «Начать поиск», «Отменить поиск», «Открыть профиль»), чтобы не заставлять печатать команды.
3) Просмотр каталога игроков (`/browse`):
   - Лента карточек профилей с пагинацией. Карточка содержит ник, возраст, язык, выбранные режимы, био и аватар (если есть).
   - Фильтры доступны из интерфейса просмотра: возрастной диапазон, язык, набор режимов. При смене фильтра бот мягко обновляет текущую карточку.
   - Из карточки можно перейти к предложению чата или пропустить/следующему профилю.
4) Таргетированный поиск (`/search`):
   - Минимастер фильтров: язык, возрастной диапазон, интересующие режимы. Пользователь видит подсказки и примеры.
   - После подтверждения фильтров бот ставит в очередь и показывает статус «Идёт поиск…» с кнопкой «Отменить».
   - При нахождении пары оба получают карточки друг друга и клавиатуру: «Предложить чат», «Пропустить», «Заблокировать» (если нужно).
   - Если один предлагает чат, второй видит запрос с вариантами «Принять», «Отклонить», «Заблокировать». Нет автосоединения без явного согласия обоих.
5) Быстрый рандом-чат (`/chat`):
   - Облегчённый вход в диалог с одним подтверждением; удобно для пользователей без фильтров.
   - Клавиатура в чате: «Завершить чат», «Пожаловаться», «Заблокировать». Есть подсказки, что собеседник рандомный.
6) Профиль (`/profile`):
   - Показывает все поля и указание, заполнены ли они. Кнопки «Редактировать ник/возраст/язык/режимы/описание/аватар», «Удалить профиль».
   - Из профиля есть быстрые ссылки на поиск или каталог, чтобы сократить количество команд.
7) Безопасность:
   - Блок- и репорт-экшены доступны в один тап в чате и на этапе предложения чата; после блокировки собеседник не подбирается снова (применяется TTL и долгосрочный бан при необходимости).
   - Команда `/blocklist` показывает, кого пользователь заблокировал, и позволяет снять блокировку.
   - Команда `/exit_chat` завершает диалог для обоих сторон и убирает клавиатуру.
8) Поддержка и отмена:
   - `/help` выводит краткую памятку по командам и ролям.
   - `/cancel` и «Отменить» на клавиатуре останавливают текущий сценарий (поиск, ввод данных) без потери профиля.
9) Реэнгейджмент и возвращение:
   - Если пользователь давно не заходил, бот может напомнить, что его ждут матчи или новые игроки.
   - При возврате бот восстанавливает состояние: если пользователь был в чате — вернёт в «chatting», если в поиске — предложит продолжить или отменить.

## UI и поведение в чате
- Формат: чистый Telegram-чат без вложенных меню. Основные действия всегда продублированы кнопками под сообщением.
- Типы клавиатур:
  - Inline-кнопки для выбора языка, режимов, фильтров, подтверждений поиска и чатов.
  - Reply-клавиатуры используются редко (например, «Отменить поиск»), удаляются после выхода из сценария, чтобы чат оставался чистым.
- Карточка профиля: текстовый блок с жирным ником, возрастом, языком, списком режимов в код-блоках и кратким описанием. Если есть фото — отправляется вместе с карточкой.
- Сообщения статусов: «Идёт поиск…», «Нашли напарника», «Ожидание подтверждения», «Чат завершён», «Вы в бане до…» — даются отдельными сообщениями, чтобы пользователь понимал контекст.
- Ошибки и ограничения: бот объясняет, что не так (например, «ник уже занят», «возраст вне диапазона», «слишком много режимов»), и предлагает повторить ввод.
- Тайминги и ожидания: при долгих операциях отправляются короткие ответы («Секунду…», «Проверяем…»), чтобы пользователь видел, что бот работает.

## Логика чатов и матчей глазами пользователя
- Очередь поиска: после выбора фильтров показывается кнопка «Отменить поиск». Если матч найден — оба видят карточку партнёра и набор действий.
- Подтверждение чата: соединение происходит только при согласии обоих. Отказ или пропуск возвращает пользователя в поиск (или завершает сценарий) и помечает пару, чтобы не предлагать её снова в ближайшее время.
- Управление беседой: «Выйти из чата» разрывает связь для обеих сторон; бот уведомляет обоих и удаляет вспомогательные клавиатуры.
- Жалобы: в процессе чата есть действие «Пожаловаться» с выбором причины; администраторы получают отчёт и могут заблокировать собеседника.

## Профиль и данные
- Поля: ник Roblox, возраст, язык интерфейса/поиска, список любимых режимов, описание, аватар.
- Изменение полей работает через мини-визарды с обратной связью; старые данные показываются как подсказка.
- Удаление профиля — отдельный шаг с подтверждением; после удаления запросы поиска недоступны до повторной регистрации.

## Каталог игр и режимов
- Пользователь видит подсказки популярных режимов по выбранному языку, чтобы упростить ввод.
- Администратор поддерживает список игр: синхронизация с JSON, добавление популярных и кастомных режимов, правки названий на EN/RU, удаление и подтверждение удаления.
- При выборе режимов бот ограничивает количество и напоминает об оставшихся слотах.

## Управление безопасностью и статусами
- Блокировка: доступна в чате и на этапе предложения. Блокированный не сможет снова попасть в подбор к инициатору.
- Бан: администратор может выдать бан на срок или бессрочно. Забаненный видит сообщение с причиной и сроком, клавиатуры скрываются.
- Просмотр бан-статуса (`/banstatus`) доступен только админам; обычный пользователь получает понятный текст при попытке взаимодействия.

## Админский опыт
- Модерация пользователей: поиск по ID или нику, просмотр профиля и контекстных действий (бан, разбан, удаление, завершение чата).
- Метрики: сводка по пользователям, активным чатам, количеству ищущих, активности за 24 часа, состоянию БД и Redis.
- Работа с чатами: список активных чатов, просмотр истории пары, блокировка конкретного чата.
- Рассылки: главный администратор может отправить широкое сообщение, подтвердив текст перед отправкой.
- Управление играми: просмотр и редактирование списка, добавление популярных/кастомных режимов, синхронизация с локальным файлом.
- Реэнгейджмент: запуск цикла уведомлений из команды, мониторинг статистики возвратов.

## Командная шпаргалка (пользователь)
- `/start` — начать/сбросить сценарий, пройти регистрацию.
- `/browse` — лента игроков с фильтрами и переходом к чату.
- `/search` — поиск по фильтрам и постановка в очередь.
- `/chat` — быстрый рандомный чат.
- `/profile` — просмотр и редактирование профиля, удаление.
- `/blocklist` — список блокировок и снятие блоков.
- `/exit_chat` — завершить активный чат.
- `/cancel` — отменить текущий шаг/поиск.
- `/help` — краткая памятка по командам.

## Принципы UX
- Минимум ввода текста: ключевые действия — через кнопки; свободный текст только там, где нужен (ник, био, режим).
- Прозрачность состояния: любое длительное действие сопровождается статусом и кнопкой отмены.
- Безопасность по умолчанию: чаты только после двойного согласия, быстрые кнопки жалобы/блока, чёткие ограничения по вводу.
- Удобство возврата: бот помнит, на чём пользователь остановился, и не теряет контекст при повторных `/start`.
- Чистый чат: системные клавиатуры удаляются после завершения сценариев; повторные сообщения с командами бот может удалять, чтобы не захламлять диалог.
